---
import Base from '../layouts/Base.astro';
import { listArticles } from '../shared/content.js';

const PAGE_SIZE = 30;
const articles = await listArticles();
const totalPages = Math.max(1, Math.ceil(articles.length / PAGE_SIZE));
const list = articles.slice(0, PAGE_SIZE);
const base = import.meta.env.BASE_URL;
const nextPath = totalPages > 1 ? `${base}p/2/` : null;
---

<Base title="TransCrab" description="水淡如常，月照如初">
  <p class="meta" style="margin-top: 0.25rem;">水淡如常，月照如初</p>

  {list.length === 0 ? <p>暂无文章。</p> : null}

  {list.map((a) => (
    <div style="padding: 1rem 0; border-bottom: 1px solid rgba(127,127,127,.25);">
      <div><a href={`${base}a/${a.yyyy}/${a.mm}/${a.slug}/`}>{a.title}</a></div>
      <div class="meta">
        <span>{a.dateDisplay ?? ''}</span>
        {a.sourceUrl ? (
          <span>
            {' '}·{' '}
            <a href={a.sourceUrl} target="_blank" rel="noreferrer">原文</a>
          </span>
        ) : null}
      </div>
    </div>
  ))}

  {totalPages > 1 ? (
    <div class="nav" style="margin-top: 1rem;">
      <span class="meta">Page 1 / {totalPages}</span>
      {' '}
      {nextPath ? <a href={nextPath}>Next →</a> : null}
    </div>
  ) : null}
</Base>
