---
import Base from '../../../../layouts/Base.astro';
import { listArticles, getArticle } from '../../../../shared/content.js';

export async function getStaticPaths() {
  const articles = await listArticles();
  return articles.map((a) => ({
    params: { yyyy: a.yyyy, mm: a.mm, slug: a.slug },
  }));
}

const { slug } = Astro.params;
const article = await getArticle(slug);
if (!article) {
  return new Response('Not found', { status: 404 });
}
const { html, title, sourceUrl, dateDisplay } = article;
---

<Base title={title}>
  <div class="nav"><a href={import.meta.env.BASE_URL}>← 返回</a></div>
  <h1>{title}</h1>
  <div class="meta">
    {dateDisplay ? <span>{dateDisplay}</span> : null}
    {sourceUrl ? <span> · <a href={sourceUrl} target="_blank" rel="noreferrer">原文链接</a></span> : null}
  </div>

  <article set:html={html} />
</Base>
